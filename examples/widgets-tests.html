<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Crud on Vue</title>
    <!-- bootstrap4 css -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <!-- minimal crud-vue css -->
    <link href="../dist/crud-vue.css" rel="stylesheet">
    <!-- font-awesome -->
    <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <!-- jQuery -->
    <script
        src="https://code.jquery.com/jquery-2.2.4.min.js"
        integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44="
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>

    <!-- Vue js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.6.11/vue.js"></script>
    <!-- crud-vue.js -->
    <script src="../dist/crud-vue.js"></script>
    <script src="./extras/ModelUser.js"></script>
</head>
<body>
    <div id="app">
        <div id="component-area">
            <w-input c-comp-ref="wTest" c-conf="conf"></w-input>
        </div>
    </div>

<script>
    var app = null;
    jQuery( function() {
        jQuery('body').on('set-code',function (event,confName) {
            console.log('event confName',confName);
            var code = window[confName+"_f"]?window[confName+"_f"].toString().match(/function[^{]+\{([\s\S]*)\}$/)[1]:"{}";
            editAreaLoader.setValue('editor',code)
        });
        app = new CrudApp({
            mounted : function() {
               tests();

            },
            data : function () {

                return {
                    // default template  html della libreria basato su bootstrap4
                    templatesFiles : '../dist/crud-vue.html',
                    // -- path plugins se usi qualche particolare plugin
                    //pluginsPath : '/bootstrap4/plugins/',
                    // -- configurazioni personali per ridefinire o aggiungere comportamenti della libreria
                    appConfig : './extras/myconf.js',
                    componentsFiles : '../dist/crud-vue-components.js',
                    el : '#app'
                };
            }
        });

    });
</script>
<script src="./extras/components-conf.js"></script>
<script>
    var testFuncs = [];
    function tests() {
        for (var k in testFuncs) {
            console.log('call ' + testFuncs[k].name);
            testFuncs[k]();
        }
    }


    var cId = 'component-area';
    var conf = {
        value : 100,
        inputType : 'float'
    };

    testFuncs.push(function testInput() {
        //jQuery('#'+cId).html('<v-list c-ref="vmia" c-conf="conf"></v-list>');
        var vC = app.$crud.cRefs['wTest'];
        console.assert(vC);
    })

    testFuncs.push(function testRadio() {
        var v = new app.$options.components['w-radio']({
            propsData : {
                cCompRef : 'wTest',
                cConf : {
                    value : 'a',
                    domainValues : {
                        a : 'AAAA',
                        b : 'BBBB',
                        c : 'CCCC'
                    }
                }
            }
        });
        var id= 'd' + (new Date().getTime());
        jQuery('#'+cId).html('<div id="'+id+'"></div>');
        v.$mount('#'+id);
        var vC = app.$crud.cRefs['wTest'];
        console.assert(vC);
        console.assert(vC.getValue() == 'a');
        vC.setValue('c');
        console.assert(vC.getValue() == 'c');
        vC.setDomainValues({
            g : 'GGG',
            h : 'HHH',
            i : 'III'
        },['i','h','g']);
        console.assert(vC.getValue() == 'i');
    })

    testFuncs.push(function testSelect() {
        var v = new app.$options.components['w-select']({
            propsData : {
                cCompRef : 'wTest',
                cConf : {
                    value : 'a',
                    domainValues : {
                        a : 'AAAA',
                        b : 'BBBB',
                        c : 'CCCC'
                    }
                }
            }
        });
        var id= 'd' + (new Date().getTime());
        jQuery('#'+cId).html('<div id="'+id+'"></div>');
        v.$mount('#'+id);
        var vC = app.$crud.cRefs['wTest'];
        console.assert(vC);
        console.assert(vC.getValue() == 'a');
        vC.setValue('c');
        console.assert(vC.getValue() == 'c');
        vC.setDomainValues({
            g : 'GGG',
            h : 'HHH',
            i : 'III'
        },['i','h','g']);
        console.assert(vC.getValue() == 'i');
    })
    testFuncs.push(function testCheckbox() {
        var v = new app.$options.components['w-checkbox']({
            propsData : {
                cCompRef : 'wTest',
                cConf : {
                    value : ['a'],
                    domainValues : {
                        a : 'AAAA',
                        b : 'BBBB',
                        c : 'CCCC'
                    }
                }
            }
        });
        var id= 'd' + (new Date().getTime());
        jQuery('#'+cId).html('<div id="'+id+'"></div>');
        v.$mount('#'+id);
        var vC = app.$crud.cRefs['wTest'];
        console.assert(vC);
        console.assert(JSON.stringify(vC.getValue()) == JSON.stringify(['a']));
        vC.setValue(['a','c']);
        console.assert(JSON.stringify(vC.getValue()) == JSON.stringify(['a','c']));
        vC.setDomainValues({
            g : 'GGG',
            h : 'HHH',
            i : 'III',
            m : 'MMM'
        },['i','h','g','m']);

        console.assert(JSON.stringify(vC.getValue()) == JSON.stringify(['i']));
    })


</script>
</body>
</html>
